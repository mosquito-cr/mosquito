<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Crystal Docs 1.10.1">
<meta name="crystal_docs.project_version" content="1.0.2">
<meta name="crystal_docs.project_name" content="mosquito">



<link href="../../css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="../../js/doc.js"></script>

  <meta name="repository-name" content="mosquito">
  <title>Mosquito::Runners::Executor - mosquito 1.0.2</title>
  <script type="text/javascript">
    CrystalDocs.base_path = "../../";
  </script>
</head>
<body>

<svg class="hidden">
  <symbol id="octicon-link" viewBox="0 0 16 16">
    <path fill="currentColor" fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
  </symbol>
</svg>
<input type="checkbox" id="sidebar-btn">
<label for="sidebar-btn" id="sidebar-btn-label">
  <svg class="open" xmlns="http://www.w3.org/2000/svg" height="2em" width="2em" viewBox="0 0 512 512"><title>Open Sidebar</title><path fill="currentColor" d="M80 96v64h352V96H80zm0 112v64h352v-64H80zm0 112v64h352v-64H80z"></path></svg>
  <svg class="close" xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 512 512"><title>Close Sidebar</title><path fill="currentColor" d="m118.6 73.4-45.2 45.2L210.7 256 73.4 393.4l45.2 45.2L256 301.3l137.4 137.3 45.2-45.2L301.3 256l137.3-137.4-45.2-45.2L256 210.7Z"></path></svg>
</label>
<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="project-summary">
      <h1 class="project-name">
        <a href="../../index.html">
          mosquito
        </a>
      </h1>

      <span class="project-version">
        1.0.2
      </span>
    </div>
  </div>

  <div class="search-results hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class="parent open current" data-id="mosquito/Mosquito" data-name="mosquito">
      <a href="../../Mosquito.html">Mosquito</a>
      
        <ul>
  
  <li class="parent " data-id="mosquito/Mosquito/Backend" data-name="mosquito::backend">
      <a href="../../Mosquito/Backend.html">Backend</a>
      
        <ul>
  
  <li class=" " data-id="mosquito/Mosquito/Backend/ClassMethods" data-name="mosquito::backend::classmethods">
      <a href="../../Mosquito/Backend/ClassMethods.html">ClassMethods</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="mosquito/Mosquito/Base" data-name="mosquito::base">
      <a href="../../Mosquito/Base.html">Base</a>
      
    </li>
  
  <li class=" " data-id="mosquito/Mosquito/Configuration" data-name="mosquito::configuration">
      <a href="../../Mosquito/Configuration.html">Configuration</a>
      
    </li>
  
  <li class=" " data-id="mosquito/Mosquito/DoubleRun" data-name="mosquito::doublerun">
      <a href="../../Mosquito/DoubleRun.html">DoubleRun</a>
      
    </li>
  
  <li class=" " data-id="mosquito/Mosquito/Id" data-name="mosquito::id">
      <a href="../../Mosquito/Id.html">Id</a>
      
    </li>
  
  <li class=" " data-id="mosquito/Mosquito/IrretrievableParameter" data-name="mosquito::irretrievableparameter">
      <a href="../../Mosquito/IrretrievableParameter.html">IrretrievableParameter</a>
      
    </li>
  
  <li class="parent " data-id="mosquito/Mosquito/Job" data-name="mosquito::job">
      <a href="../../Mosquito/Job.html">Job</a>
      
        <ul>
  
  <li class=" " data-id="mosquito/Mosquito/Job/State" data-name="mosquito::job::state">
      <a href="../../Mosquito/Job/State.html">State</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="mosquito/Mosquito/JobFailed" data-name="mosquito::jobfailed">
      <a href="../../Mosquito/JobFailed.html">JobFailed</a>
      
    </li>
  
  <li class=" " data-id="mosquito/Mosquito/JobRun" data-name="mosquito::jobrun">
      <a href="../../Mosquito/JobRun.html">JobRun</a>
      
    </li>
  
  <li class=" " data-id="mosquito/Mosquito/KeyBuilder" data-name="mosquito::keybuilder">
      <a href="../../Mosquito/KeyBuilder.html">KeyBuilder</a>
      
    </li>
  
  <li class=" " data-id="mosquito/Mosquito/Metadata" data-name="mosquito::metadata">
      <a href="../../Mosquito/Metadata.html">Metadata</a>
      
    </li>
  
  <li class=" " data-id="mosquito/Mosquito/PeriodicJob" data-name="mosquito::periodicjob">
      <a href="../../Mosquito/PeriodicJob.html">PeriodicJob</a>
      
    </li>
  
  <li class=" " data-id="mosquito/Mosquito/PeriodicJobRun" data-name="mosquito::periodicjobrun">
      <a href="../../Mosquito/PeriodicJobRun.html">PeriodicJobRun</a>
      
    </li>
  
  <li class=" " data-id="mosquito/Mosquito/Queue" data-name="mosquito::queue">
      <a href="../../Mosquito/Queue.html">Queue</a>
      
    </li>
  
  <li class=" " data-id="mosquito/Mosquito/QueuedJob" data-name="mosquito::queuedjob">
      <a href="../../Mosquito/QueuedJob.html">QueuedJob</a>
      
    </li>
  
  <li class="parent " data-id="mosquito/Mosquito/RateLimiter" data-name="mosquito::ratelimiter">
      <a href="../../Mosquito/RateLimiter.html">RateLimiter</a>
      
        <ul>
  
  <li class=" " data-id="mosquito/Mosquito/RateLimiter/ClassMethods" data-name="mosquito::ratelimiter::classmethods">
      <a href="../../Mosquito/RateLimiter/ClassMethods.html">ClassMethods</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="mosquito/Mosquito/RedisBackend" data-name="mosquito::redisbackend">
      <a href="../../Mosquito/RedisBackend.html">RedisBackend</a>
      
    </li>
  
  <li class="parent " data-id="mosquito/Mosquito/Runnable" data-name="mosquito::runnable">
      <a href="../../Mosquito/Runnable.html">Runnable</a>
      
        <ul>
  
  <li class=" " data-id="mosquito/Mosquito/Runnable/State" data-name="mosquito::runnable::state">
      <a href="../../Mosquito/Runnable/State.html">State</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="mosquito/Mosquito/Runner" data-name="mosquito::runner">
      <a href="../../Mosquito/Runner.html">Runner</a>
      
    </li>
  
  <li class="parent open current" data-id="mosquito/Mosquito/Runners" data-name="mosquito::runners">
      <a href="../../Mosquito/Runners.html">Runners</a>
      
        <ul>
  
  <li class=" " data-id="mosquito/Mosquito/Runners/Coordinator" data-name="mosquito::runners::coordinator">
      <a href="../../Mosquito/Runners/Coordinator.html">Coordinator</a>
      
    </li>
  
  <li class=" current" data-id="mosquito/Mosquito/Runners/Executor" data-name="mosquito::runners::executor">
      <a href="../../Mosquito/Runners/Executor.html">Executor</a>
      
    </li>
  
  <li class=" " data-id="mosquito/Mosquito/Runners/IdleWait" data-name="mosquito::runners::idlewait">
      <a href="../../Mosquito/Runners/IdleWait.html">IdleWait</a>
      
    </li>
  
  <li class=" " data-id="mosquito/Mosquito/Runners/Overseer" data-name="mosquito::runners::overseer">
      <a href="../../Mosquito/Runners/Overseer.html">Overseer</a>
      
    </li>
  
  <li class=" " data-id="mosquito/Mosquito/Runners/QueueList" data-name="mosquito::runners::queuelist">
      <a href="../../Mosquito/Runners/QueueList.html">QueueList</a>
      
    </li>
  
  <li class=" " data-id="mosquito/Mosquito/Runners/RunAtMost" data-name="mosquito::runners::runatmost">
      <a href="../../Mosquito/Runners/RunAtMost.html">RunAtMost</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="mosquito/Mosquito/ScheduledJob" data-name="mosquito::scheduledjob">
      <a href="../../Mosquito/ScheduledJob.html">ScheduledJob</a>
      
    </li>
  
  <li class=" " data-id="mosquito/Mosquito/Scripts" data-name="mosquito::scripts">
      <a href="../../Mosquito/Scripts.html">Scripts</a>
      
    </li>
  
  <li class="parent " data-id="mosquito/Mosquito/Serializers" data-name="mosquito::serializers">
      <a href="../../Mosquito/Serializers.html">Serializers</a>
      
        <ul>
  
  <li class=" " data-id="mosquito/Mosquito/Serializers/Primitives" data-name="mosquito::serializers::primitives">
      <a href="../../Mosquito/Serializers/Primitives.html">Primitives</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="mosquito/Mosquito/TestBackend" data-name="mosquito::testbackend">
      <a href="../../Mosquito/TestBackend.html">TestBackend</a>
      
        <ul>
  
  <li class=" " data-id="mosquito/Mosquito/TestBackend/EnqueuedJob" data-name="mosquito::testbackend::enqueuedjob">
      <a href="../../Mosquito/TestBackend/EnqueuedJob.html">EnqueuedJob</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<h1 class="type-name">

  <span class="kind">class</span> Mosquito::<wbr>Runners::<wbr>Executor

</h1>


  <ul class="superclass-hierarchy"><li class="superclass"><a href="../../Mosquito/Runners/Executor.html">Mosquito::Runners::Executor</a></li><li class="superclass">Reference</li><li class="superclass">Object</li></ul>




  <h2>
    <a id="overview" class="anchor" href="#overview">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
    Overview
  </h2>

  <p>The executor is the center of work in Mosquito, and it's is the demarcation
point between Mosquito framework and application code. Above the Executor
is entirely Mosquito, and below it is application code.</p>
<p>An Executor is responsible for hydrating Job classes with deserialized
parameters and calling <code><a href="../../Mosquito/Job.html#run-instance-method">Mosquito::Job#run</a></code> on them. It measures the time it
takes to run a job and provides detailed log messages about the current
status.</p>
<p>An executor is a <code><a href="../../Mosquito/Runnable.html">Mosquito::Runnable</a></code> and should be interacted with according to
the Runnable API.</p>
<p>To build an executor, provide a job input channel and an idle bell channel. These
channels can be shared between all available executors.</p>
<p>The executor will ring the idle bell when it is ready to accept work and then wait
for work to show up on the job pipeline. After the job is finished it will ring the
bell again and wait for more work.</p>





  <h2>
    <a id="included-modules" class="anchor" href="#included-modules">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
    Included Modules
  </h2>
  <ul class="other-types-list">
    
      <li class="other-type"><a href="../../Mosquito/Runnable.html">Mosquito::Runnable</a></li>
    
      <li class="other-type"><a href="../../Mosquito/Runners/RunAtMost.html">Mosquito::Runners::RunAtMost</a></li>
    
  </ul>










  <h2>
    <a id="defined-in" class="anchor" href="#defined-in">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
    Defined in:
  </h2>
  
    
      mosquito/runners/executor.cr
    
    <br/>
  



  
    <h2>
      <a id="constant-summary" class="anchor" href="#constant-summary">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
      Constant Summary
    </h2>
  
  <dl>
    
      <dt class="entry-const" id="Log">
        <strong>Log</strong> = <code><span class="t">::</span><span class="t">Log</span>.<span class="k">for</span>(<span class="k">self</span>)</code>
      </dt>
      
    
  </dl>



  <h2>
    <a id="constructors" class="anchor" href="#constructors">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
    Constructors
  </h2>
  <ul class="list-summary">
    
      <li class="entry-summary">
        <a href="#new%28job_pipeline%3AChannel%28Tuple%28Mosquito%3A%3AJobRun%2CMosquito%3A%3AQueue%29%29%2Cidle_bell%3AChannel%28Bool%29%29-class-method" class="signature"><strong>.new</strong>(job_pipeline : Channel(Tuple(Mosquito::JobRun, Mosquito::Queue)), idle_bell : Channel(Bool))</a>
        
      </li>
    
  </ul>







  <h2>
    <a id="instance-method-summary" class="anchor" href="#instance-method-summary">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
    Instance Method Summary
  </h2>
  <ul class="list-summary">
    
      <li class="entry-summary">
        <a href="#execute%28job_run%3AJobRun%2Cfrom_queueq%3AQueue%29-instance-method" class="signature"><strong>#execute</strong>(job_run : JobRun, from_queue q : Queue)</a>
        
          <div class="summary"><p>Runs a job from a Queue.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#failed_job_ttl%3AInt32-instance-method" class="signature"><strong>#failed_job_ttl</strong> : Int32</a>
        
          <div class="summary"><p>How long a job config is persisted after failure</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#failed_job_ttl%3D%28failed_job_ttl%3AInt32%29-instance-method" class="signature"><strong>#failed_job_ttl=</strong>(failed_job_ttl : Int32)</a>
        
          <div class="summary"><p>How long a job config is persisted after failure</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#idle_bell%3AChannel%28Bool%29-instance-method" class="signature"><strong>#idle_bell</strong> : Channel(Bool)</a>
        
          <div class="summary"><p>Used to notify the overseer that this executor is idle.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#job_pipeline%3AChannel%28Tuple%28JobRun%2CQueue%29%29-instance-method" class="signature"><strong>#job_pipeline</strong> : Channel(Tuple(JobRun, Queue))</a>
        
          <div class="summary"><p>Where work is received from the overseer.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#log%3A%3A%3ALog-instance-method" class="signature"><strong>#log</strong> : ::Log</a>
        
      </li>
    
      <li class="entry-summary">
        <a href="#successful_job_ttl%3AInt32-instance-method" class="signature"><strong>#successful_job_ttl</strong> : Int32</a>
        
          <div class="summary"><p>How long a job config is persisted after success</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#successful_job_ttl%3D%28successful_job_ttl%3AInt32%29-instance-method" class="signature"><strong>#successful_job_ttl=</strong>(successful_job_ttl : Int32)</a>
        
          <div class="summary"><p>How long a job config is persisted after success</p></div>
        
      </li>
    
  </ul>



<div class="methods-inherited">
  
    

  <h3>Instance methods inherited from module <code><a href="../../Mosquito/Runnable.html">Mosquito::Runnable</a></code></h3>
  
  
    <a href="../../Mosquito/Runnable.html#dead%3F%3ABool-instance-method" class="tooltip">
      <span>dead? : Bool</span>
    dead?</a>, 
    
  
    <a href="../../Mosquito/Runnable.html#each_run%3ANil-instance-method" class="tooltip">
      <span>each_run : Nil</span>
    each_run</a>, 
    
  
    <a href="../../Mosquito/Runnable.html#fiber%3AFiber%7CNil-instance-method" class="tooltip">
      <span>fiber : Fiber | Nil</span>
    fiber</a>, 
    
  
    <a href="../../Mosquito/Runnable.html#my_name%3AString-instance-method" class="tooltip">
      <span>my_name : String</span>
    my_name</a>, 
    
  
    <a href="../../Mosquito/Runnable.html#post_run%3ANil-instance-method" class="tooltip">
      <span>post_run : Nil</span>
    post_run</a>, 
    
  
    <a href="../../Mosquito/Runnable.html#pre_run%3ANil-instance-method" class="tooltip">
      <span>pre_run : Nil</span>
    pre_run</a>, 
    
  
    <a href="../../Mosquito/Runnable.html#run-instance-method" class="tooltip">
      <span>run</span>
    run</a>, 
    
  
    <a href="../../Mosquito/Runnable.html#runnable_name%3AString-instance-method" class="tooltip">
      <span>runnable_name : String</span>
    runnable_name</a>, 
    
  
    <a href="../../Mosquito/Runnable.html#state%3AState-instance-method" class="tooltip">
      <span>state : State</span>
    state</a>, 
    
  
    <a href="../../Mosquito/Runnable.html#stop%3AChannel%28Bool%29-instance-method" class="tooltip">
      <span>stop : Channel(Bool)</span>
    stop</a>
    
  


    


    


    


  
    

  <h3>Instance methods inherited from module <code><a href="../../Mosquito/Runners/RunAtMost.html">Mosquito::Runners::RunAtMost</a></code></h3>
  
  
    <a href="../../Mosquito/Runners/RunAtMost.html#execution_timestamps-instance-method" class="tooltip">
      <span>execution_timestamps</span>
    execution_timestamps</a>
    
  


    


    


    


  
    


    


    


    


  
    


    


    


    


  
</div>


  <h2>
    <a id="constructor-detail" class="anchor" href="#constructor-detail">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
    Constructor Detail
  </h2>
  
    <div class="entry-detail" id="new(job_pipeline:Channel(Tuple(Mosquito::JobRun,Mosquito::Queue)),idle_bell:Channel(Bool))-class-method">
      <div class="signature">
        
        def self.<strong>new</strong>(job_pipeline : Channel(Tuple(<a href="../../Mosquito/JobRun.html">Mosquito::JobRun</a>, <a href="../../Mosquito/Queue.html">Mosquito::Queue</a>)), idle_bell : Channel(Bool))

        <a class="method-permalink" href="#new%28job_pipeline%3AChannel%28Tuple%28Mosquito%3A%3AJobRun%2CMosquito%3A%3AQueue%29%29%2Cidle_bell%3AChannel%28Bool%29%29-class-method">#</a>
      </div>
      
      <br/>
      <div>
        
      </div>
    </div>
  







  <h2>
    <a id="instance-method-detail" class="anchor" href="#instance-method-detail">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
    Instance Method Detail
  </h2>
  
    <div class="entry-detail" id="execute(job_run:JobRun,from_queueq:Queue)-instance-method">
      <div class="signature">
        
        def <strong>execute</strong>(job_run : <a href="../../Mosquito/JobRun.html">JobRun</a>, from_queue q : <a href="../../Mosquito/Queue.html">Queue</a>)

        <a class="method-permalink" href="#execute%28job_run%3AJobRun%2Cfrom_queueq%3AQueue%29-instance-method">#</a>
      </div>
      
        <div class="doc">
          
          <p>Runs a job from a Queue.</p>
<p>Execution time is measured and logged, and the job is either forgotten
or, if it fails, rescheduled.</p>
        </div>
      
      <br/>
      <div>
        
      </div>
    </div>
  
    <div class="entry-detail" id="failed_job_ttl:Int32-instance-method">
      <div class="signature">
        
        def <strong>failed_job_ttl</strong> : Int32

        <a class="method-permalink" href="#failed_job_ttl%3AInt32-instance-method">#</a>
      </div>
      
        <div class="doc">
          
          <p>How long a job config is persisted after failure</p>
        </div>
      
      <br/>
      <div>
        
      </div>
    </div>
  
    <div class="entry-detail" id="failed_job_ttl=(failed_job_ttl:Int32)-instance-method">
      <div class="signature">
        
        def <strong>failed_job_ttl=</strong>(failed_job_ttl : Int32)

        <a class="method-permalink" href="#failed_job_ttl%3D%28failed_job_ttl%3AInt32%29-instance-method">#</a>
      </div>
      
        <div class="doc">
          
          <p>How long a job config is persisted after failure</p>
        </div>
      
      <br/>
      <div>
        
      </div>
    </div>
  
    <div class="entry-detail" id="idle_bell:Channel(Bool)-instance-method">
      <div class="signature">
        
        def <strong>idle_bell</strong> : Channel(Bool)

        <a class="method-permalink" href="#idle_bell%3AChannel%28Bool%29-instance-method">#</a>
      </div>
      
        <div class="doc">
          
          <p>Used to notify the overseer that this executor is idle.</p>
        </div>
      
      <br/>
      <div>
        
      </div>
    </div>
  
    <div class="entry-detail" id="job_pipeline:Channel(Tuple(JobRun,Queue))-instance-method">
      <div class="signature">
        
        def <strong>job_pipeline</strong> : Channel(Tuple(<a href="../../Mosquito/JobRun.html">JobRun</a>, <a href="../../Mosquito/Queue.html">Queue</a>))

        <a class="method-permalink" href="#job_pipeline%3AChannel%28Tuple%28JobRun%2CQueue%29%29-instance-method">#</a>
      </div>
      
        <div class="doc">
          
          <p>Where work is received from the overseer.</p>
        </div>
      
      <br/>
      <div>
        
      </div>
    </div>
  
    <div class="entry-detail" id="log:::Log-instance-method">
      <div class="signature">
        
        def <strong>log</strong> : ::Log

        <a class="method-permalink" href="#log%3A%3A%3ALog-instance-method">#</a>
      </div>
      
      <br/>
      <div>
        
      </div>
    </div>
  
    <div class="entry-detail" id="successful_job_ttl:Int32-instance-method">
      <div class="signature">
        
        def <strong>successful_job_ttl</strong> : Int32

        <a class="method-permalink" href="#successful_job_ttl%3AInt32-instance-method">#</a>
      </div>
      
        <div class="doc">
          
          <p>How long a job config is persisted after success</p>
        </div>
      
      <br/>
      <div>
        
      </div>
    </div>
  
    <div class="entry-detail" id="successful_job_ttl=(successful_job_ttl:Int32)-instance-method">
      <div class="signature">
        
        def <strong>successful_job_ttl=</strong>(successful_job_ttl : Int32)

        <a class="method-permalink" href="#successful_job_ttl%3D%28successful_job_ttl%3AInt32%29-instance-method">#</a>
      </div>
      
        <div class="doc">
          
          <p>How long a job config is persisted after success</p>
        </div>
      
      <br/>
      <div>
        
      </div>
    </div>
  


</div>

</body>
</html>
